stages:
  - install
  - test
  - build
  - deploy

variables:
  VIRTUAL_ENV: ".venv"
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

before_script:
  - python -V
  - pip install --upgrade pip
  - python -m venv $VIRTUAL_ENV
  - source $VIRTUAL_ENV/bin/activate
  - pip install -r requirements.txt

install:
  stage: install
  script:
    - echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"

test:
  stage: test
  script:
    - echo "üîé –ü—Ä–æ–≥–æ–Ω—è–µ–º —Ç–µ—Å—Ç—ã"
    - pytest || echo "‚ö†Ô∏è –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç"

build:
  stage: build
  script:
    - echo "üì¶ –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
    - python setup.py sdist || echo "‚ö†Ô∏è –ù–µ—Ç setup.py, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"

deploy:
  stage: deploy
  script:
    - echo "üöÄ –î–µ–ø–ª–æ–π..."
    # –î–æ–±–∞–≤—å —Å—é–¥–∞ —Å–≤–æ—é –ª–æ–≥–∏–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä SCP –∏–ª–∏ Ansible
  only:
    - main
